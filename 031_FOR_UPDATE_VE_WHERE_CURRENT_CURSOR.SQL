DROP TABLE EMPLOYEES2;

CREATE TABLE EMPÇOYEES2
AS
SELECT * FROM EMPLOYEES;

DECLARE
  CURSOR C_EMP
  IS
  SELECT *
  FROM EMPLOYEES
  FOR UPDATE; -- HANGI AMAÇLA SELECT ETTİĞİMİZİ YAZIYORUZ.
  -- EGER AYNI AYDA BAŞKA BIR KULLANICIDA UPDATE EDERSE SORUN OLUR.
  -- AYNI ANDA BIRDEN FAZLA TRANSACTION CALISABILIYOR CUNKU.
  -- CAKISMA OLMASIN DIYE LOCKLAMA GEREKIYOR.
  -- FOR UPDATE ASLINDA CAKISMALARI LOCK'LAYARAK ONLUYOR.
  -- LOCK KAYDIN KILITLENMESI DEMEKTIR.
  -- IKI FARKLI TRANSACTION AYNI ANDA UPDATE ETMEYE KALKARSA SIRAYA KOYULUR VE ILK KULLANICI ICIN KAYIT KILITLENIR.
  -- FOR UPDATE KAYDIN TAMAMINI LOCK'LAR KILITLER.
  -- FOR UPDATE OF [KOLON ADI] SADECE ILGILI GUNCELLENECEK KOLONU KILITLER.
  -- SADECE UPDATE DEGIL DELETE YAPACAKSAK YINE FOR UPDATE KULLANILIR.
BEGIN
  FOR R_OKU
  IN C_EMP
  LOOP
    IF R_EMP.SALARY < 5000 THEN
      UPDATE EMPLOYEES2
      SET SALARY = SALARY 1.2
      -- WHERE EMPLOYEE_ID = R._EMP.EMPLOYEE_ID;
      WHERE CURRENT OF C_EMP; -- CURRENT O ANKI DEMEKTIR. YANI SON OKUNAN KAYDI UPDATE EDECEKTIR.
    END IF;
  END LOOP;
  COMMIT; -- LOCK COMMIT VEYA ROLLBACK ILE RELEASE EDILIR YANI KILIT KALKAR.
  -- ROLLBACK;
END;

SELECT * FROM EMPLOYEES2;
