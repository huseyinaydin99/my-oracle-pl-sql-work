DECLARE

    CURSOR DEPT_OKU
    IS
    SELECT DEPTNO, DNAME
    FROM DEPT;

    REC_DEPT DEPT_OKU%ROWTYPE;

    CURSOR EMP_OKU(P_DEPTNO DEPT.DEPTNO%TYPE)
    IS
    SELECT EMPNO, ENAME, SAL, JOB
    FROM EMP
    WHERE DEPTNO = P_DEPTNO
    ORDER BY EMPNO;

    REC_EMP EMP_OKU%ROWTYPE;

    PARAGRAF VARCHAR2(2000);
    TEXTDOSYA UTL_FILE.FILE_TYPE;
BEGIN
    TEXTDOSYA := UTL_FILE.FOPEN('TEXT_DIR', 'TXTTEMP.TXT', 'W');
    OPEN DEPT_OKU;
    LOOP
        FETCH DEPT_OKU
        INTO REC_DEPT;

        EXIT WHEN DEPT_OKU%NOTFOUND;
        UTL_FILE.PUT_LINE(TEXTDOSYA, ' BOLUM NO VE ADI: ' || REC_DEPT.DEPTNO || ' : ' || REC_DEPT.DNAME);
        OPEN EMP_OKU(REC_DEPT.DEPTNO);
        LOOP
            FETCH EMP_OKU
            INTO REC_EMP;

            EXIT WHEN EMP_OKU%NOTFOUND;

            PARAGRAF := REC_EMP.EMPNO || ' ' || REC_EMP.ENAME || ' ' || REC_EMP.SAL || ' ' || REC_EMP.JOB;
            UTL_FILE.PUT_LINE(TEXTDOSYA, PARAGRAF);
        END LOOP;
        CLOSE EMP_OKU;
        UTL_FILE.PUT_LINE(TEXTDOSYA, '');
    END LOOP;
    IF UTL_FILE.IS_OPEN(TEXTDOSYA) THEN
        UTL_FILE.FCLOSE(TEXTDOSYA);
    END IF;
END;