SELECT *
FROM EMP;

CREATE OR REPLACE
DIRECTORY EXCEL_DIR
AS 'C:\\EXCELS';

GRANT READ, WRITE
ON DIRECTORY EXCEL_DIR
TO HR;

CREATE OR REPLACE
PROCEDURE CSV_EMP(
    P_SEP VARCHAR2(1)
)
IS
    CURSOR OKU
    IS
    (SELECT E.EMPNO, E.ENAME, E.SAL, E.DEPTNO, D.DNAME
    FROM EMP E, DEPT D
    WHERE E.DEPTNO = D.DEPTNO);

    R_OKU OKU%ROWTYPE;

    WSATIR VARCHAR2(4000);

    DOSYA UTL_FILE.FILE_TYPE;
    HATALI_SEP EXCEPTION;
BEGIN
    IF P_SEP NOT IN(';', '/') THEN
        RAISE HATALI_SEP;
    END IF;
    DOSYA := UTL_FILE.FOPEN(LOCATION => 'EXCEL_DIR', FILENAME => 'EMP_DEPT.CSV', OPEN_MODE => 'W', MAX_LINESIZE => 32767);
    OPEN OKU;
    LOOP
        FETCH OKU
        INTO R_OKU;

        EXIT WHEN OKU%NOTFOUND;

        WSATIR := R_OKU.EMPNO || P_SEP || R_OKU.ENAME || P_SEP || R_OKU.SAL || P_SEP || R_OKU.DEPTNO || P_SEP || R_OKU.DNAME;

        UTL_FILE.PUT_LINE(DOSYA, WSATIR);
    END LOOP;
    CLOSE OKU;
    UTL_FILE.FCLOSE(DOSYA);
    EXCEPTION WHEN HATALI_SEP THEN
        PRINT('ALAN AYRACI HATALI ; / OLABILIR BASKA BIRSEY KABUL EDILEMEZ!!!!!');
              WHEN OTHERS THEN
              RAISE;
END;

EXEC CSV_EMP('?');